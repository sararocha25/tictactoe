{"ast":null,"code":"import _regeneratorRuntime from\"C:/Users/Irene Canelas/Documents/GitHub/tictactoe/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/regenerator\";import _asyncToGenerator from\"C:/Users/Irene Canelas/Documents/GitHub/tictactoe/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/asyncToGenerator\";import _toConsumableArray from\"C:/Users/Irene Canelas/Documents/GitHub/tictactoe/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import _slicedToArray from\"C:/Users/Irene Canelas/Documents/GitHub/tictactoe/web/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from\"react\";import{Link,useLocation,useHistory}from\"react-router-dom\";import{API_URL}from\"../../utils/constants\";import{searchGame}from\"../../utils/searchGame\";import socket from\"../../utils/socket\";import\"./game.css\";import{toast,Slide}from\"react-toastify\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var Square=function Square(_ref){var onClick=_ref.onClick,value=_ref.value;return/*#__PURE__*/_jsx(\"button\",{className:\"square\",onClick:onClick,children:value});};var Board=function Board(_ref2){var mode=_ref2.mode,gameId=_ref2.gameId;var _useState=useState([]),_useState2=_slicedToArray(_useState,2),squares=_useState2[0],setSquares=_useState2[1];var _useState3=useState(true),_useState4=_slicedToArray(_useState3,2),xIsNext=_useState4[0],setXIsNext=_useState4[1];var _useState5=useState(null),_useState6=_slicedToArray(_useState5,2),gameStatus=_useState6[0],setGameStatus=_useState6[1];var _useState7=useState(false),_useState8=_slicedToArray(_useState7,2),enableRestart=_useState8[0],setEnableRestart=_useState8[1];var playingAs=mode===\"CREATE\"?\"X\":\"O\";var history=useHistory();var squaresRef=useRef(squares);useEffect(function(){squaresRef.current=squares;});var showToast=function showToast(text){return toast(text,{position:\"bottom-center\",hideProgressBar:true,draggable:false,autoClose:5000,pauseOnHover:false,closeOnClick:true,transition:Slide});};useEffect(function(){var gameResult=calculateWinner(squares);if(gameResult){if(gameResult.winner&&!gameResult.gameTied){setGameStatus(\"Winner : \".concat(gameResult.winner));}if(gameResult.gameTied&&!gameResult.winner){setGameStatus(\"Game Tied\");}}else{setGameStatus(\"Next Player : \".concat(xIsNext?mode===\"CREATE\"?\"You\":\"X\":mode===\"JOIN\"?\"You\":\"O\"));}},[squares]);useEffect(function(){getBoard();socket.on(\"moved\",updateBoard);socket.on(\"restarted\",function(){getBoard();showToast(\"Game Restarted !\");});return function(){socket.off(\"moved\",updateBoard);};},[]);var updateBoard=function updateBoard(data){var updatedSquares=_toConsumableArray(squaresRef.current);updatedSquares[data.position]=data.player;setSquares(updatedSquares);setXIsNext(data.next===\"X\");var gameResult=calculateWinner(updatedSquares);if(gameResult)setEnableRestart(true);if(gameResult===null||gameResult===void 0?void 0:gameResult.gameTied){showToast(\"Game Tied\");}if(gameResult===null||gameResult===void 0?void 0:gameResult.winner){if(gameResult.winner===playingAs){showToast(\"You won üéâÔ∏è\");}else{showToast(\"You lost\");}}};var getBoard=/*#__PURE__*/function(){var _ref3=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee(){var res,data,status;return _regeneratorRuntime.wrap(function _callee$(_context){while(1){switch(_context.prev=_context.next){case 0:setEnableRestart(false);_context.next=3;return fetch(\"\".concat(API_URL,\"api/fetch/game/\").concat(gameId));case 3:res=_context.sent;_context.next=6;return res.json();case 6:data=_context.sent;if(data.result===\"success\"){setSquares(data.board);setXIsNext(data.next===\"X\");status=calculateWinner(data.board);if(status)setEnableRestart(true);}else if(data.result===\"fail\"){history.replace({pathname:\"/\"});}case 8:case\"end\":return _context.stop();}}},_callee);}));return function getBoard(){return _ref3.apply(this,arguments);};}();var handleClick=function handleClick(i){var tempSquares=squares.slice();var gameResult=calculateWinner(squares);if(gameResult||squares[i]){if(gameResult===null||gameResult===void 0?void 0:gameResult.gameTied){showToast(\"Game Tied\");}else if(gameResult===null||gameResult===void 0?void 0:gameResult.winner){if(gameResult.winner===playingAs){showToast(\"You won üéâÔ∏è\");}else{showToast(\"You lost\");}}return;}if(mode===\"CREATE\"&&xIsNext){tempSquares[i]=\"X\";setSquares(tempSquares);setXIsNext(false);socket.emit(\"move\",{player:tempSquares[i],position:i,game_id:gameId});}else if(mode===\"JOIN\"&&!xIsNext){tempSquares[i]=\"O\";setSquares(tempSquares);setXIsNext(true);socket.emit(\"move\",{player:tempSquares[i],position:i,game_id:gameId});}};var renderSquare=function renderSquare(i){return/*#__PURE__*/_jsx(Square,{value:squares[i],onClick:function onClick(){return handleClick(i);}});};var restartGame=function restartGame(){return socket.emit(\"restartGame\",{game_id:gameId});};return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col space-y-4 items-center\",children:[/*#__PURE__*/_jsx(\"p\",{className:\"text-gray-500 text-sm md:text-base\",children:gameStatus}),/*#__PURE__*/_jsxs(\"div\",{children:[/*#__PURE__*/_jsxs(\"div\",{className:\"board-row\",children:[renderSquare(0),renderSquare(1),renderSquare(2)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"board-row\",children:[renderSquare(3),renderSquare(4),renderSquare(5)]}),/*#__PURE__*/_jsxs(\"div\",{className:\"board-row\",children:[renderSquare(6),renderSquare(7),renderSquare(8)]})]}),/*#__PURE__*/_jsxs(\"p\",{children:[\"Playing as : \",/*#__PURE__*/_jsx(\"b\",{children:playingAs})]}),enableRestart&&/*#__PURE__*/_jsx(\"button\",{onClick:restartGame,children:\"Restart\"})]});};function calculateWinner(boardData){var lines=[[0,1,2],[3,4,5],[6,7,8],[0,3,6],[1,4,7],[2,5,8],[0,4,8],[2,4,6]];for(var i=0;i<lines.length;i++){var _lines$i=_slicedToArray(lines[i],3),a=_lines$i[0],b=_lines$i[1],c=_lines$i[2];if(boardData[a]&&boardData[a]===boardData[b]&&boardData[a]===boardData[c]){return{winner:boardData[a],gameTied:false};}}if(boardData.includes(null)===false){return{winner:null,gameTied:true};}return null;}var Game=function Game(){var _location$state,_location$state2;var _useState9=useState(0),_useState10=_slicedToArray(_useState9,2),online=_useState10[0],setOnline=_useState10[1];var location=useLocation();var history=useHistory();var connected=function connected(data){return setOnline(data.online.length);};var gameId=(_location$state=location.state)===null||_location$state===void 0?void 0:_location$state.gameId;var mode=((_location$state2=location.state)===null||_location$state2===void 0?void 0:_location$state2.mode)||\"JOIN\";var checkIfGameExists=/*#__PURE__*/function(){var _ref4=_asyncToGenerator(/*#__PURE__*/_regeneratorRuntime.mark(function _callee2(){var gameExists;return _regeneratorRuntime.wrap(function _callee2$(_context2){while(1){switch(_context2.prev=_context2.next){case 0:_context2.next=2;return searchGame(gameId.toString());case 2:gameExists=_context2.sent;if(!gameExists){history.replace({pathname:\"/\"});}case 4:case\"end\":return _context2.stop();}}},_callee2);}));return function checkIfGameExists(){return _ref4.apply(this,arguments);};}();useEffect(function(){if(location.state!==undefined&&gameId)checkIfGameExists();},[]);useEffect(function(){if(location.state!==undefined&&gameId)socket.emit(\"join\",{game_id:gameId,player:mode===\"CREATE\"?\"X\":\"O\"});socket.on(\"connected\",connected);socket.on(\"disconnected\",connected);return function(){socket.emit(\"leave\",{game_id:gameId,player:mode===\"CREATE\"?\"X\":\"O\"});socket.off(\"connected\");};},[]);if(!location.state||!gameId)history.replace({pathname:\"/\"});return/*#__PURE__*/_jsxs(\"div\",{className:\"flex flex-col items-center px-4\",style:{height:window.innerHeight},children:[/*#__PURE__*/_jsx(Link,{to:\"/\",className:\"underline text-gray-500\",children:\"Go Home\"}),/*#__PURE__*/_jsxs(\"p\",{className:\"self-end md:text-lg\",children:[\"Joined: \",online]}),/*#__PURE__*/_jsx(\"div\",{className:\"flex-grow-1 h-full justify-center flex flex-col\",children:/*#__PURE__*/_jsx(Board,{gameId:gameId,mode:mode})}),/*#__PURE__*/_jsxs(\"a\",{target:\"_blank\",href:window.location.origin+\"/join/\"+gameId,className:\"my-4 text-gray-500 text-sm md:text-base\",rel:\"noreferrer\",children:[\"Game: \",gameId]})]});};export default Game;","map":{"version":3,"sources":["C:/Users/Irene Canelas/Documents/GitHub/tictactoe/web/src/pages/Game/index.tsx"],"names":["React","useEffect","useRef","useState","Link","useLocation","useHistory","API_URL","searchGame","socket","toast","Slide","Square","onClick","value","Board","mode","gameId","squares","setSquares","xIsNext","setXIsNext","gameStatus","setGameStatus","enableRestart","setEnableRestart","playingAs","history","squaresRef","current","showToast","text","position","hideProgressBar","draggable","autoClose","pauseOnHover","closeOnClick","transition","gameResult","calculateWinner","winner","gameTied","getBoard","on","updateBoard","off","data","updatedSquares","player","next","fetch","res","json","result","board","status","replace","pathname","handleClick","i","tempSquares","slice","emit","game_id","renderSquare","restartGame","boardData","lines","length","a","b","c","includes","Game","online","setOnline","location","connected","state","checkIfGameExists","toString","gameExists","undefined","height","window","innerHeight","origin"],"mappings":"qrBAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,MAA3B,CAAmCC,QAAnC,KAAmD,OAAnD,CACA,OAASC,IAAT,CAAeC,WAAf,CAA4BC,UAA5B,KAA8C,kBAA9C,CACA,OAASC,OAAT,KAAwB,uBAAxB,CACA,OAASC,UAAT,KAA2B,wBAA3B,CACA,MAAOC,CAAAA,MAAP,KAAmB,oBAAnB,CACA,MAAO,YAAP,CACA,OAASC,KAAT,CAAgBC,KAAhB,KAA6B,gBAA7B,C,wFAOA,GAAMC,CAAAA,MAA6B,CAAG,QAAhCA,CAAAA,MAAgC,UAAGC,CAAAA,OAAH,MAAGA,OAAH,CAAYC,KAAZ,MAAYA,KAAZ,oBACrC,eAAQ,SAAS,CAAC,QAAlB,CAA2B,OAAO,CAAED,OAApC,UACEC,KADF,EADqC,EAAtC,CAsBA,GAAMC,CAAAA,KAA2B,CAAG,QAA9BA,CAAAA,KAA8B,OAAsB,IAAnBC,CAAAA,IAAmB,OAAnBA,IAAmB,CAAbC,MAAa,OAAbA,MAAa,CACzD,cAA8Bd,QAAQ,CAAuB,EAAvB,CAAtC,wCAAOe,OAAP,eAAgBC,UAAhB,eACA,eAA8BhB,QAAQ,CAAC,IAAD,CAAtC,yCAAOiB,OAAP,eAAgBC,UAAhB,eACA,eAAoClB,QAAQ,CAAgB,IAAhB,CAA5C,yCAAOmB,UAAP,eAAmBC,aAAnB,eACA,eAA0CpB,QAAQ,CAAC,KAAD,CAAlD,yCAAOqB,aAAP,eAAsBC,gBAAtB,eAEA,GAAMC,CAAAA,SAAS,CAAGV,IAAI,GAAK,QAAT,CAAoB,GAApB,CAA0B,GAA5C,CAEA,GAAMW,CAAAA,OAAO,CAAGrB,UAAU,EAA1B,CAEA,GAAMsB,CAAAA,UAAU,CAAG1B,MAAM,CAACgB,OAAD,CAAzB,CAEAjB,SAAS,CAAC,UAAM,CACf2B,UAAU,CAACC,OAAX,CAAqBX,OAArB,CACA,CAFQ,CAAT,CAIA,GAAMY,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAACC,IAAD,QACjBrB,CAAAA,KAAK,CAACqB,IAAD,CAAO,CACXC,QAAQ,CAAE,eADC,CAEXC,eAAe,CAAE,IAFN,CAGXC,SAAS,CAAE,KAHA,CAIXC,SAAS,CAAE,IAJA,CAKXC,YAAY,CAAE,KALH,CAMXC,YAAY,CAAE,IANH,CAOXC,UAAU,CAAE3B,KAPD,CAAP,CADY,EAAlB,CAUAV,SAAS,CAAC,UAAM,CACf,GAAMsC,CAAAA,UAAU,CAAGC,eAAe,CAACtB,OAAD,CAAlC,CACA,GAAIqB,UAAJ,CAAgB,CACf,GAAIA,UAAU,CAACE,MAAX,EAAqB,CAACF,UAAU,CAACG,QAArC,CAA+C,CAC9CnB,aAAa,oBAAagB,UAAU,CAACE,MAAxB,EAAb,CACA,CACD,GAAIF,UAAU,CAACG,QAAX,EAAuB,CAACH,UAAU,CAACE,MAAvC,CAA+C,CAC9ClB,aAAa,CAAC,WAAD,CAAb,CACA,CACD,CAPD,IAOO,CACNA,aAAa,yBAEXH,OAAO,CACJJ,IAAI,GAAK,QAAT,CACC,KADD,CAEC,GAHG,CAIJA,IAAI,GAAK,MAAT,CACA,KADA,CAEA,GARQ,EAAb,CAWA,CACD,CAtBQ,CAsBN,CAACE,OAAD,CAtBM,CAAT,CAwBAjB,SAAS,CAAC,UAAM,CACf0C,QAAQ,GACRlC,MAAM,CAACmC,EAAP,CAAU,OAAV,CAAmBC,WAAnB,EACApC,MAAM,CAACmC,EAAP,CAAU,WAAV,CAAuB,UAAM,CAC5BD,QAAQ,GACRb,SAAS,CAAC,kBAAD,CAAT,CACA,CAHD,EAIA,MAAO,WAAM,CACZrB,MAAM,CAACqC,GAAP,CAAW,OAAX,CAAoBD,WAApB,EACA,CAFD,CAGA,CAVQ,CAUN,EAVM,CAAT,CAYA,GAAMA,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACE,IAAD,CAA+B,CAClD,GAAMC,CAAAA,cAAc,oBAAOpB,UAAU,CAACC,OAAlB,CAApB,CACAmB,cAAc,CAACD,IAAI,CAACf,QAAN,CAAd,CAAgCe,IAAI,CAACE,MAArC,CACA9B,UAAU,CAAC6B,cAAD,CAAV,CACA3B,UAAU,CAAC0B,IAAI,CAACG,IAAL,GAAc,GAAf,CAAV,CACA,GAAMX,CAAAA,UAAU,CAAGC,eAAe,CAACQ,cAAD,CAAlC,CACA,GAAIT,UAAJ,CAAgBd,gBAAgB,CAAC,IAAD,CAAhB,CAChB,GAAIc,UAAJ,SAAIA,UAAJ,iBAAIA,UAAU,CAAEG,QAAhB,CAA0B,CACzBZ,SAAS,CAAC,WAAD,CAAT,CACA,CAED,GAAIS,UAAJ,SAAIA,UAAJ,iBAAIA,UAAU,CAAEE,MAAhB,CAAwB,CACvB,GAAIF,UAAU,CAACE,MAAX,GAAsBf,SAA1B,CAAqC,CACpCI,SAAS,CAAC,aAAD,CAAT,CACA,CAFD,IAEO,CACNA,SAAS,CAAC,UAAD,CAAT,CACA,CACD,CACD,CAlBD,CAoBA,GAAMa,CAAAA,QAAQ,2FAAG,uJAChBlB,gBAAgB,CAAC,KAAD,CAAhB,CADgB,sBAEE0B,CAAAA,KAAK,WAAI5C,OAAJ,2BAA6BU,MAA7B,EAFP,QAEVmC,GAFU,qCAGsBA,CAAAA,GAAG,CAACC,IAAJ,EAHtB,QAGVN,IAHU,eAIhB,GAAIA,IAAI,CAACO,MAAL,GAAgB,SAApB,CAA+B,CAC9BnC,UAAU,CAAC4B,IAAI,CAACQ,KAAN,CAAV,CACAlC,UAAU,CAAC0B,IAAI,CAACG,IAAL,GAAc,GAAf,CAAV,CACMM,MAHwB,CAGfhB,eAAe,CAACO,IAAI,CAACQ,KAAN,CAHA,CAI9B,GAAIC,MAAJ,CAAY/B,gBAAgB,CAAC,IAAD,CAAhB,CACZ,CALD,IAKO,IAAIsB,IAAI,CAACO,MAAL,GAAgB,MAApB,CAA4B,CAClC3B,OAAO,CAAC8B,OAAR,CAAgB,CAAEC,QAAQ,CAAE,GAAZ,CAAhB,EACA,CAXe,sDAAH,kBAARf,CAAAA,QAAQ,2CAAd,CAcA,GAAMgB,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,CAACC,CAAD,CAAe,CAClC,GAAMC,CAAAA,WAAW,CAAG3C,OAAO,CAAC4C,KAAR,EAApB,CACA,GAAMvB,CAAAA,UAAU,CAAGC,eAAe,CAACtB,OAAD,CAAlC,CAEA,GAAIqB,UAAU,EAAIrB,OAAO,CAAC0C,CAAD,CAAzB,CAA8B,CAC7B,GAAIrB,UAAJ,SAAIA,UAAJ,iBAAIA,UAAU,CAAEG,QAAhB,CAA0B,CACzBZ,SAAS,CAAC,WAAD,CAAT,CACA,CAFD,IAEO,IAAIS,UAAJ,SAAIA,UAAJ,iBAAIA,UAAU,CAAEE,MAAhB,CAAwB,CAC9B,GAAIF,UAAU,CAACE,MAAX,GAAsBf,SAA1B,CAAqC,CACpCI,SAAS,CAAC,aAAD,CAAT,CACA,CAFD,IAEO,CACNA,SAAS,CAAC,UAAD,CAAT,CACA,CACD,CACD,OACA,CAED,GAAId,IAAI,GAAK,QAAT,EAAqBI,OAAzB,CAAkC,CACjCyC,WAAW,CAACD,CAAD,CAAX,CAAiB,GAAjB,CACAzC,UAAU,CAAC0C,WAAD,CAAV,CACAxC,UAAU,CAAC,KAAD,CAAV,CACAZ,MAAM,CAACsD,IAAP,CAAY,MAAZ,CAAoB,CACnBd,MAAM,CAAEY,WAAW,CAACD,CAAD,CADA,CAEnB5B,QAAQ,CAAE4B,CAFS,CAGnBI,OAAO,CAAE/C,MAHU,CAApB,EAKA,CATD,IASO,IAAID,IAAI,GAAK,MAAT,EAAmB,CAACI,OAAxB,CAAiC,CACvCyC,WAAW,CAACD,CAAD,CAAX,CAAiB,GAAjB,CACAzC,UAAU,CAAC0C,WAAD,CAAV,CACAxC,UAAU,CAAC,IAAD,CAAV,CACAZ,MAAM,CAACsD,IAAP,CAAY,MAAZ,CAAoB,CACnBd,MAAM,CAAEY,WAAW,CAACD,CAAD,CADA,CAEnB5B,QAAQ,CAAE4B,CAFS,CAGnBI,OAAO,CAAE/C,MAHU,CAApB,EAKA,CACD,CApCD,CAsCA,GAAMgD,CAAAA,YAAY,CAAG,QAAfA,CAAAA,YAAe,CAACL,CAAD,qBACpB,KAAC,MAAD,EAAQ,KAAK,CAAE1C,OAAO,CAAC0C,CAAD,CAAtB,CAA2B,OAAO,CAAE,yBAAMD,CAAAA,WAAW,CAACC,CAAD,CAAjB,EAApC,EADoB,EAArB,CAIA,GAAMM,CAAAA,WAAW,CAAG,QAAdA,CAAAA,WAAc,SAAMzD,CAAAA,MAAM,CAACsD,IAAP,CAAY,aAAZ,CAA2B,CAAEC,OAAO,CAAE/C,MAAX,CAA3B,CAAN,EAApB,CAEA,mBACC,aAAK,SAAS,CAAC,sCAAf,wBACC,UAAG,SAAS,CAAC,oCAAb,UAAmDK,UAAnD,EADD,cAGC,oCACC,aAAK,SAAS,CAAC,WAAf,WACE2C,YAAY,CAAC,CAAD,CADd,CAEEA,YAAY,CAAC,CAAD,CAFd,CAGEA,YAAY,CAAC,CAAD,CAHd,GADD,cAMC,aAAK,SAAS,CAAC,WAAf,WACEA,YAAY,CAAC,CAAD,CADd,CAEEA,YAAY,CAAC,CAAD,CAFd,CAGEA,YAAY,CAAC,CAAD,CAHd,GAND,cAWC,aAAK,SAAS,CAAC,WAAf,WACEA,YAAY,CAAC,CAAD,CADd,CAEEA,YAAY,CAAC,CAAD,CAFd,CAGEA,YAAY,CAAC,CAAD,CAHd,GAXD,GAHD,cAoBC,kDACc,mBAAIvC,SAAJ,EADd,GApBD,CAuBEF,aAAa,eAAI,eAAQ,OAAO,CAAE0C,WAAjB,qBAvBnB,GADD,CA2BA,CAvKD,CAyKA,QAAS1B,CAAAA,eAAT,CAAyB2B,SAAzB,CAA0D,CACzD,GAAMC,CAAAA,KAAK,CAAG,CACb,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CADa,CAEb,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAFa,CAGb,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAHa,CAIb,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAJa,CAKb,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CALa,CAMb,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CANa,CAOb,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CAPa,CAQb,CAAC,CAAD,CAAI,CAAJ,CAAO,CAAP,CARa,CAAd,CAUA,IAAK,GAAIR,CAAAA,CAAC,CAAG,CAAb,CAAgBA,CAAC,CAAGQ,KAAK,CAACC,MAA1B,CAAkCT,CAAC,EAAnC,CAAuC,CACtC,4BAAkBQ,KAAK,CAACR,CAAD,CAAvB,IAAOU,CAAP,aAAUC,CAAV,aAAaC,CAAb,aACA,GACCL,SAAS,CAACG,CAAD,CAAT,EACAH,SAAS,CAACG,CAAD,CAAT,GAAiBH,SAAS,CAACI,CAAD,CAD1B,EAEAJ,SAAS,CAACG,CAAD,CAAT,GAAiBH,SAAS,CAACK,CAAD,CAH3B,CAIE,CACD,MAAO,CACN/B,MAAM,CAAE0B,SAAS,CAACG,CAAD,CADX,CAEN5B,QAAQ,CAAE,KAFJ,CAAP,CAIA,CACD,CACD,GAAIyB,SAAS,CAACM,QAAV,CAAmB,IAAnB,IAA6B,KAAjC,CAAwC,CACvC,MAAO,CACNhC,MAAM,CAAE,IADF,CAENC,QAAQ,CAAE,IAFJ,CAAP,CAIA,CACD,MAAO,KAAP,CACA,CAYD,GAAMgC,CAAAA,IAAmB,CAAG,QAAtBA,CAAAA,IAAsB,EAAM,sCACjC,eAA4BvE,QAAQ,CAAC,CAAD,CAApC,0CAAOwE,MAAP,gBAAeC,SAAf,gBAEA,GAAMC,CAAAA,QAAQ,CAAGxE,WAAW,EAA5B,CACA,GAAMsB,CAAAA,OAAO,CAAGrB,UAAU,EAA1B,CAEA,GAAMwE,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAC/B,IAAD,QACjB6B,CAAAA,SAAS,CAAC7B,IAAI,CAAC4B,MAAL,CAAYN,MAAb,CADQ,EAAlB,CAGA,GAAMpD,CAAAA,MAAM,kBAAI4D,QAAQ,CAACE,KAAb,0CAAG,gBAAuC9D,MAAtD,CACA,GAAMD,CAAAA,IAAI,CAAG,mBAAC6D,QAAQ,CAACE,KAAV,4DAAuC/D,IAAvC,GAA+C,MAA5D,CAEA,GAAMgE,CAAAA,iBAAiB,2FAAG,8KACAxE,CAAAA,UAAU,CAACS,MAAM,CAACgE,QAAP,EAAD,CADV,QACnBC,UADmB,gBAEzB,GAAI,CAACA,UAAL,CAAiB,CAChBvD,OAAO,CAAC8B,OAAR,CAAgB,CACfC,QAAQ,CAAE,GADK,CAAhB,EAGA,CANwB,wDAAH,kBAAjBsB,CAAAA,iBAAiB,2CAAvB,CASA/E,SAAS,CAAC,UAAM,CACf,GAAI4E,QAAQ,CAACE,KAAT,GAAmBI,SAAnB,EAAgClE,MAApC,CAA4C+D,iBAAiB,GAC7D,CAFQ,CAEN,EAFM,CAAT,CAIA/E,SAAS,CAAC,UAAM,CACf,GAAI4E,QAAQ,CAACE,KAAT,GAAmBI,SAAnB,EAAgClE,MAApC,CACCR,MAAM,CAACsD,IAAP,CAAY,MAAZ,CAAoB,CACnBC,OAAO,CAAE/C,MADU,CAEnBgC,MAAM,CAAEjC,IAAI,GAAK,QAAT,CAAoB,GAApB,CAA0B,GAFf,CAApB,EAKDP,MAAM,CAACmC,EAAP,CAAU,WAAV,CAAuBkC,SAAvB,EACArE,MAAM,CAACmC,EAAP,CAAU,cAAV,CAA0BkC,SAA1B,EACA,MAAO,WAAM,CACZrE,MAAM,CAACsD,IAAP,CAAY,OAAZ,CAAqB,CACpBC,OAAO,CAAE/C,MADW,CAEpBgC,MAAM,CAAEjC,IAAI,GAAK,QAAT,CAAoB,GAApB,CAA0B,GAFd,CAArB,EAIAP,MAAM,CAACqC,GAAP,CAAW,WAAX,EACA,CAND,CAOA,CAhBQ,CAgBN,EAhBM,CAAT,CAkBA,GAAI,CAAC+B,QAAQ,CAACE,KAAV,EAAmB,CAAC9D,MAAxB,CACCU,OAAO,CAAC8B,OAAR,CAAgB,CACfC,QAAQ,CAAE,GADK,CAAhB,EAID,mBACC,aACC,SAAS,CAAC,iCADX,CAEC,KAAK,CAAE,CACN0B,MAAM,CAAEC,MAAM,CAACC,WADT,CAFR,wBAMC,KAAC,IAAD,EAAM,EAAE,CAAC,GAAT,CAAa,SAAS,CAAC,yBAAvB,qBAND,cAUC,WAAG,SAAS,CAAC,qBAAb,sBAA4CX,MAA5C,GAVD,cAYC,YAAK,SAAS,CAAC,iDAAf,uBACC,KAAC,KAAD,EAAO,MAAM,CAAE1D,MAAf,CAAuB,IAAI,CAAED,IAA7B,EADD,EAZD,cAgBC,WACC,MAAM,CAAC,QADR,CAEC,IAAI,CAAEqE,MAAM,CAACR,QAAP,CAAgBU,MAAhB,CAAyB,QAAzB,CAAoCtE,MAF3C,CAGC,SAAS,CAAC,yCAHX,CAIC,GAAG,CAAC,YAJL,oBAMQA,MANR,GAhBD,GADD,CA2BA,CA3ED,CA6EA,cAAeyD,CAAAA,IAAf","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\";\r\nimport { Link, useLocation, useHistory } from \"react-router-dom\";\r\nimport { API_URL } from \"../../utils/constants\";\r\nimport { searchGame } from \"../../utils/searchGame\";\r\nimport socket from \"../../utils/socket\";\r\nimport \"./game.css\";\r\nimport { toast, Slide } from \"react-toastify\";\r\n\r\ntype SquareProps = {\r\n\tonClick: React.MouseEventHandler<HTMLButtonElement> | undefined;\r\n\tvalue: string | null;\r\n};\r\n\r\nconst Square: React.FC<SquareProps> = ({ onClick, value }) => (\r\n\t<button className=\"square\" onClick={onClick}>\r\n\t\t{value}\r\n\t</button>\r\n);\r\n\r\ntype BoardProps = {\r\n\tmode: \"CREATE\" | \"JOIN\";\r\n\tgameId: number;\r\n};\r\n\r\ntype FetchGameResponse = {\r\n\tresult: \"fail\" | \"success\";\r\n\tboard: Array<string | null>;\r\n\tnext: \"X\" | \"O\";\r\n};\r\n\r\ntype UpdateBoardResponse = {\r\n\tposition: number;\r\n\tnext: \"X\" | \"O\";\r\n\tplayer: any;\r\n};\r\nconst Board: React.FC<BoardProps> = ({ mode, gameId }) => {\r\n\tconst [squares, setSquares] = useState<Array<string | null>>([]);\r\n\tconst [xIsNext, setXIsNext] = useState(true);\r\n\tconst [gameStatus, setGameStatus] = useState<string | null>(null);\r\n\tconst [enableRestart, setEnableRestart] = useState(false);\r\n\r\n\tconst playingAs = mode === \"CREATE\" ? \"X\" : \"O\";\r\n\r\n\tconst history = useHistory();\r\n\r\n\tconst squaresRef = useRef(squares);\r\n\r\n\tuseEffect(() => {\r\n\t\tsquaresRef.current = squares;\r\n\t});\r\n\r\n\tconst showToast = (text: string) =>\r\n\t\ttoast(text, {\r\n\t\t\tposition: \"bottom-center\",\r\n\t\t\thideProgressBar: true,\r\n\t\t\tdraggable: false,\r\n\t\t\tautoClose: 5000,\r\n\t\t\tpauseOnHover: false,\r\n\t\t\tcloseOnClick: true,\r\n\t\t\ttransition: Slide,\r\n\t\t});\r\n\tuseEffect(() => {\r\n\t\tconst gameResult = calculateWinner(squares);\r\n\t\tif (gameResult) {\r\n\t\t\tif (gameResult.winner && !gameResult.gameTied) {\r\n\t\t\t\tsetGameStatus(`Winner : ${gameResult.winner}`);\r\n\t\t\t}\r\n\t\t\tif (gameResult.gameTied && !gameResult.winner) {\r\n\t\t\t\tsetGameStatus(\"Game Tied\");\r\n\t\t\t}\r\n\t\t} else {\r\n\t\t\tsetGameStatus(\r\n\t\t\t\t`Next Player : ${\r\n\t\t\t\t\txIsNext\r\n\t\t\t\t\t\t? mode === \"CREATE\"\r\n\t\t\t\t\t\t\t? \"You\"\r\n\t\t\t\t\t\t\t: \"X\"\r\n\t\t\t\t\t\t: mode === \"JOIN\"\r\n\t\t\t\t\t\t? \"You\"\r\n\t\t\t\t\t\t: \"O\"\r\n\t\t\t\t}`\r\n\t\t\t);\r\n\t\t}\r\n\t}, [squares]);\r\n\r\n\tuseEffect(() => {\r\n\t\tgetBoard();\r\n\t\tsocket.on(\"moved\", updateBoard);\r\n\t\tsocket.on(\"restarted\", () => {\r\n\t\t\tgetBoard();\r\n\t\t\tshowToast(\"Game Restarted !\");\r\n\t\t});\r\n\t\treturn () => {\r\n\t\t\tsocket.off(\"moved\", updateBoard);\r\n\t\t};\r\n\t}, []);\r\n\r\n\tconst updateBoard = (data: UpdateBoardResponse) => {\r\n\t\tconst updatedSquares = [...squaresRef.current];\r\n\t\tupdatedSquares[data.position] = data.player;\r\n\t\tsetSquares(updatedSquares);\r\n\t\tsetXIsNext(data.next === \"X\");\r\n\t\tconst gameResult = calculateWinner(updatedSquares);\r\n\t\tif (gameResult) setEnableRestart(true);\r\n\t\tif (gameResult?.gameTied) {\r\n\t\t\tshowToast(\"Game Tied\");\r\n\t\t}\r\n\r\n\t\tif (gameResult?.winner) {\r\n\t\t\tif (gameResult.winner === playingAs) {\r\n\t\t\t\tshowToast(\"You won üéâÔ∏è\");\r\n\t\t\t} else {\r\n\t\t\t\tshowToast(\"You lost\");\r\n\t\t\t}\r\n\t\t}\r\n\t};\r\n\r\n\tconst getBoard = async () => {\r\n\t\tsetEnableRestart(false);\r\n\t\tconst res = await fetch(`${API_URL}api/fetch/game/${gameId}`);\r\n\t\tconst data: FetchGameResponse = await res.json();\r\n\t\tif (data.result === \"success\") {\r\n\t\t\tsetSquares(data.board);\r\n\t\t\tsetXIsNext(data.next === \"X\");\r\n\t\t\tconst status = calculateWinner(data.board);\r\n\t\t\tif (status) setEnableRestart(true);\r\n\t\t} else if (data.result === \"fail\") {\r\n\t\t\thistory.replace({ pathname: \"/\" });\r\n\t\t}\r\n\t};\r\n\r\n\tconst handleClick = (i: number) => {\r\n\t\tconst tempSquares = squares.slice();\r\n\t\tconst gameResult = calculateWinner(squares);\r\n\r\n\t\tif (gameResult || squares[i]) {\r\n\t\t\tif (gameResult?.gameTied) {\r\n\t\t\t\tshowToast(\"Game Tied\");\r\n\t\t\t} else if (gameResult?.winner) {\r\n\t\t\t\tif (gameResult.winner === playingAs) {\r\n\t\t\t\t\tshowToast(\"You won üéâÔ∏è\");\r\n\t\t\t\t} else {\r\n\t\t\t\t\tshowToast(\"You lost\");\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\treturn;\r\n\t\t}\r\n\r\n\t\tif (mode === \"CREATE\" && xIsNext) {\r\n\t\t\ttempSquares[i] = \"X\";\r\n\t\t\tsetSquares(tempSquares);\r\n\t\t\tsetXIsNext(false);\r\n\t\t\tsocket.emit(\"move\", {\r\n\t\t\t\tplayer: tempSquares[i],\r\n\t\t\t\tposition: i,\r\n\t\t\t\tgame_id: gameId,\r\n\t\t\t});\r\n\t\t} else if (mode === \"JOIN\" && !xIsNext) {\r\n\t\t\ttempSquares[i] = \"O\";\r\n\t\t\tsetSquares(tempSquares);\r\n\t\t\tsetXIsNext(true);\r\n\t\t\tsocket.emit(\"move\", {\r\n\t\t\t\tplayer: tempSquares[i],\r\n\t\t\t\tposition: i,\r\n\t\t\t\tgame_id: gameId,\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tconst renderSquare = (i: number) => (\r\n\t\t<Square value={squares[i]} onClick={() => handleClick(i)} />\r\n\t);\r\n\r\n\tconst restartGame = () => socket.emit(\"restartGame\", { game_id: gameId });\r\n\r\n\treturn (\r\n\t\t<div className=\"flex flex-col space-y-4 items-center\">\r\n\t\t\t<p className=\"text-gray-500 text-sm md:text-base\">{gameStatus}</p>\r\n\r\n\t\t\t<div>\r\n\t\t\t\t<div className=\"board-row\">\r\n\t\t\t\t\t{renderSquare(0)}\r\n\t\t\t\t\t{renderSquare(1)}\r\n\t\t\t\t\t{renderSquare(2)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"board-row\">\r\n\t\t\t\t\t{renderSquare(3)}\r\n\t\t\t\t\t{renderSquare(4)}\r\n\t\t\t\t\t{renderSquare(5)}\r\n\t\t\t\t</div>\r\n\t\t\t\t<div className=\"board-row\">\r\n\t\t\t\t\t{renderSquare(6)}\r\n\t\t\t\t\t{renderSquare(7)}\r\n\t\t\t\t\t{renderSquare(8)}\r\n\t\t\t\t</div>\r\n\t\t\t</div>\r\n\t\t\t<p>\r\n\t\t\t\tPlaying as : <b>{playingAs}</b>\r\n\t\t\t</p>\r\n\t\t\t{enableRestart && <button onClick={restartGame}>Restart</button>}\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nfunction calculateWinner(boardData: Array<string | null>) {\r\n\tconst lines = [\r\n\t\t[0, 1, 2],\r\n\t\t[3, 4, 5],\r\n\t\t[6, 7, 8],\r\n\t\t[0, 3, 6],\r\n\t\t[1, 4, 7],\r\n\t\t[2, 5, 8],\r\n\t\t[0, 4, 8],\r\n\t\t[2, 4, 6],\r\n\t];\r\n\tfor (let i = 0; i < lines.length; i++) {\r\n\t\tconst [a, b, c] = lines[i];\r\n\t\tif (\r\n\t\t\tboardData[a] &&\r\n\t\t\tboardData[a] === boardData[b] &&\r\n\t\t\tboardData[a] === boardData[c]\r\n\t\t) {\r\n\t\t\treturn {\r\n\t\t\t\twinner: boardData[a],\r\n\t\t\t\tgameTied: false,\r\n\t\t\t};\r\n\t\t}\r\n\t}\r\n\tif (boardData.includes(null) === false) {\r\n\t\treturn {\r\n\t\t\twinner: null,\r\n\t\t\tgameTied: true,\r\n\t\t};\r\n\t}\r\n\treturn null;\r\n}\r\n\r\ntype LocationStateType = {\r\n\tgameId: number;\r\n\tmode: \"CREATE\" | \"JOIN\";\r\n};\r\n\r\ntype SocketConnectedData = {\r\n\tgame_id: string;\r\n\tonline: string[];\r\n};\r\n\r\nconst Game: React.FC<any> = () => {\r\n\tconst [online, setOnline] = useState(0);\r\n\r\n\tconst location = useLocation();\r\n\tconst history = useHistory();\r\n\r\n\tconst connected = (data: SocketConnectedData) =>\r\n\t\tsetOnline(data.online.length);\r\n\r\n\tconst gameId = (location.state as LocationStateType)?.gameId;\r\n\tconst mode = (location.state as LocationStateType)?.mode || \"JOIN\";\r\n\r\n\tconst checkIfGameExists = async () => {\r\n\t\tconst gameExists = await searchGame(gameId.toString());\r\n\t\tif (!gameExists) {\r\n\t\t\thistory.replace({\r\n\t\t\t\tpathname: \"/\",\r\n\t\t\t});\r\n\t\t}\r\n\t};\r\n\r\n\tuseEffect(() => {\r\n\t\tif (location.state !== undefined && gameId) checkIfGameExists();\r\n\t}, []);\r\n\r\n\tuseEffect(() => {\r\n\t\tif (location.state !== undefined && gameId)\r\n\t\t\tsocket.emit(\"join\", {\r\n\t\t\t\tgame_id: gameId,\r\n\t\t\t\tplayer: mode === \"CREATE\" ? \"X\" : \"O\",\r\n\t\t\t});\r\n\r\n\t\tsocket.on(\"connected\", connected);\r\n\t\tsocket.on(\"disconnected\", connected);\r\n\t\treturn () => {\r\n\t\t\tsocket.emit(\"leave\", {\r\n\t\t\t\tgame_id: gameId,\r\n\t\t\t\tplayer: mode === \"CREATE\" ? \"X\" : \"O\",\r\n\t\t\t});\r\n\t\t\tsocket.off(\"connected\");\r\n\t\t};\r\n\t}, []);\r\n\r\n\tif (!location.state || !gameId)\r\n\t\thistory.replace({\r\n\t\t\tpathname: \"/\",\r\n\t\t});\r\n\r\n\treturn (\r\n\t\t<div\r\n\t\t\tclassName=\"flex flex-col items-center px-4\"\r\n\t\t\tstyle={{\r\n\t\t\t\theight: window.innerHeight,\r\n\t\t\t}}\r\n\t\t>\r\n\t\t\t<Link to=\"/\" className=\"underline text-gray-500\">\r\n\t\t\t\tGo Home\r\n\t\t\t</Link>\r\n\r\n\t\t\t<p className=\"self-end md:text-lg\">Joined: {online}</p>\r\n\r\n\t\t\t<div className=\"flex-grow-1 h-full justify-center flex flex-col\">\r\n\t\t\t\t<Board gameId={gameId} mode={mode} />\r\n\t\t\t</div>\r\n\r\n\t\t\t<a\r\n\t\t\t\ttarget=\"_blank\"\r\n\t\t\t\thref={window.location.origin + \"/join/\" + gameId}\r\n\t\t\t\tclassName=\"my-4 text-gray-500 text-sm md:text-base\"\r\n\t\t\t\trel=\"noreferrer\"\r\n\t\t\t>\r\n\t\t\t\tGame: {gameId}\r\n\t\t\t</a>\r\n\t\t</div>\r\n\t);\r\n};\r\n\r\nexport default Game;\r\n"]},"metadata":{},"sourceType":"module"}